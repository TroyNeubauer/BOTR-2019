<html lang="en" dir="ltr">
<head>
	<script src="struct-helper.js"></script>
	<script src="packet-handler.js"></script>
	<script>
		var littleEndian = true;
		readTextFile("../Test Project/Opcodes.h", function(text) {
			var macros = findMacros(text);
			console.log(JSON.stringify(macros, null, 2));
			var structs = findStructs(text);
			var struct = structs["GPSData"];
			console.log("struct " + JSON.stringify(struct, null, 2));
			readBinaryFile("../Test Project/out.dat", function(view) {
				console.log("read file!");
				//handleData(structs, macros, view, littleEndian);
			});
			var buffer = new ArrayBuffer(100);
			var view = new DataView(buffer);
			var obj = {"lng": -100, "lat": 100, "altitude": 6969, "speed": 199999, "heading": 0, "satellites": 1, "epochTime": 69696969};
			writeStruct(struct, obj, view, 0, true);


			var saveByteArray = (function () {
	    		var a = document.createElement("a");
	    		document.body.appendChild(a);
	    		//a.style = "display: none";
	    		return function (data, name) {
					var blob = new Blob(data, {type: "octet/stream"}),
	        		url = window.URL.createObjectURL(blob);
			        a.href = url;
			        a.download = name;
			        a.click();
			        window.URL.revokeObjectURL(url);
					console.log("DOwnloading file?");
			    };
			}());

			saveByteArray([view], 'in.dat');
		});
		var buf = new ArrayBuffer(100);
		saveByteArray([buf], 'in.dat');
	</script>
</head>
<body>
	<p>test</p>
</body>
</html>
